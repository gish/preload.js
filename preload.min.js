/**
 * A preloader with timeout support
 */!function(e,t){"use strict";var n=function(t){this.items=[],this.defaults={timeout:0,loadedItemCallback:function(e,t){},finishedCallback:function(){},timeoutCallback:function(){}},this.options=e.extend(this.defaults,t),this.numTotalItems=0,this.numLoadedItems=0,this.finished=!1,this.timedout=!1,this.watchdog=null};n.prototype={addItem:function(e,t){var n={tag:e,src:t};this.items.push(n),this.numTotalItems++},start:function(){this.options.timeout>0&&this.startWatchdog(),this.step()},step:function(){var t=this,n;n=this.items.pop();if(!n)return;if(n.tag=="audio"||n.tag=="video"){var r=e("<"+n.tag+">",{src:n.src});r.bind("canplay",function(){r.unbind("canplay"),t.preloadCallback()})}else e("<"+n.tag+">",{src:n.src,load:function(){t.preloadCallback()}})},startWatchdog:function(){var e=this;this.watchdog||(this.watchdog=setTimeout(function(){e.callWatchdog()},this.options.timeout))},callWatchdog:function(){this.timedout=!0,this.options.timeoutCallback()},preloadCallback:function(){if(this.timedout)return;this.numLoadedItems++,this.options.loadedItemCallback(this.numLoadedItems,this.numTotalItems),this.items.length==0?this.finished||(clearTimeout(this.watchdog),this.finished=!0,this.options.finishedCallback()):this.step()}},t.Preloader=n}(window.jQuery,this);